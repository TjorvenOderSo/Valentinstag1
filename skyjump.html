<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>SkyJump</title>
<style>
body{ margin:0; overflow:hidden; background:linear-gradient(#ffe0f0,#ff80b0);}
canvas{ display:block; }
#hud{
  position:absolute; top:10px; left:10px; color:white; font-family:sans-serif; font-size:22px;
}
#gameOver{
  position:absolute; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  color:white; font-family:sans-serif;
  display:flex; justify-content:center; align-items:center;
  flex-direction:column; font-size:30px;
  display:none;
}
#gameOver button{
  margin-top:20px; padding:10px 20px; font-size:24px; cursor:pointer;
  background:#ff4fa0; border:none; color:white; border-radius:8px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="hud">Herzen: 0 / 40</div>

<div id="gameOver">
  <div>PAHAHA DU OPFERðŸ«µðŸ˜‚</div>
  <button onclick="restartGame()">Neu starten</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let hearts = 0;
const targetHearts = 40;

// Physik
let gravity = 0.25;
let jumpStrength = 12;

// Ball
let ball = {x:canvas.width/2, y:canvas.height-50, radius:25, dy:0, onPlatform:false, jumpCooldown:0};

// Plattformen
let platforms = [];
let groundPlatform = {x:0, y:canvas.height-20, width:canvas.width, height:20, isGround:true};
platforms.push(groundPlatform);

// ZufÃ¤llige Plattformen
for(let i=1;i<10;i++){
  platforms.push({
    x: Math.random()*(canvas.width-120),
    y: canvas.height - i*120,
    width: 120,
    height:15,
    isGround:false
  });
}

const gameOverDiv = document.getElementById("gameOver");

function drawBall(){
  ctx.fillStyle="#ff4fa0";
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius,0,Math.PI*2);
  ctx.fill();
}

function drawPlatforms(){
  ctx.fillStyle="#aa88aa";
  platforms.forEach(p=>{
    ctx.fillRect(p.x,p.y,p.width,p.height);
  });
}

function update(){
  if(ball.jumpCooldown > 0) ball.jumpCooldown--;

  ball.dy += gravity;
  ball.y += ball.dy;
  ball.onPlatform = false;

  platforms.forEach((p,i)=>{
    if(ball.x + ball.radius > p.x && ball.x - ball.radius < p.x + p.width &&
       ball.y + ball.radius > p.y && ball.y + ball.radius < p.y + p.height &&
       ball.dy > 0){

      ball.y = p.y - ball.radius;
      ball.onPlatform = true;

      if(ball.jumpCooldown === 0){
        if(!p.isGround){
          ball.dy = -jumpStrength;
          ball.jumpCooldown = 8;
          hearts++;
        }
      }

      if(!p.isGround){
        // Entferne Bodenplattform nach erstem Sprung
        platforms = platforms.filter(pl => !pl.isGround);
      }
    }
  });

  // Scroll
  if(ball.y < canvas.height/2){
    let diff = canvas.height/2 - ball.y;
    ball.y = canvas.height/2;
    platforms.forEach(p=>{
      p.y += diff;
      if(p.y > canvas.height){
        p.y = 0;
        if(!p.isGround){
          p.x = Math.random()*(canvas.width-120);
        }
      }
    });
  }

  // Herz-Ziel erreicht
  if(hearts >= targetHearts){
    setTimeout(()=>{ location.href="after1.html"; },500);
  }

  // Ball fÃ¤llt zu weit â†’ Game Over
  if(ball.y > canvas.height){
    showGameOver();
  }

  document.getElementById("hud").innerText = `Herzen: ${hearts} / ${targetHearts}`;
}

function showGameOver(){
  gameOverDiv.style.display = "flex";
}

function restartGame(){
  // Reset
  ball.x = canvas.width/2;
  ball.y = canvas.height-50;
  ball.dy = 0;
  hearts = 0;
  platforms = platforms.filter(p=>p.isGround); // nur Bodenplattform behalten
  gameOverDiv.style.display = "none";
}

document.addEventListener("mousemove",(e)=>{
  ball.x = e.clientX;
});

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPlatforms();
  drawBall();
  update();
  requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>
