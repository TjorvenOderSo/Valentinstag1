<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>SkyJump</title>
<style>
body{ margin:0; overflow:hidden; background:linear-gradient(#ffe0f0,#ff80b0);}
canvas{ display:block; }
#hud{
  position:absolute; top:10px; left:10px; color:white; font-family:sans-serif; font-size:22px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="hud">Herzen: 0 / 40</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let hearts = 0;
const targetHearts = 40;

// Physik
let gravity = 0.25;
let jumpStrength = 12;

// Ball
let ball = {x:canvas.width/2, y:canvas.height-50, radius:25, dy:0, onPlatform:false, jumpCooldown:0};

// Plattformen
let platforms = [];

// Bodenplattform – ganz unten, über gesamte Breite
let groundPlatform = {x:0, y:canvas.height-20, width:canvas.width, height:20, isGround:true};
platforms.push(groundPlatform);

// Zufällige Plattformen
for(let i=1;i<10;i++){
  platforms.push({
    x: Math.random()*(canvas.width-120),
    y: canvas.height - i*120,
    width: 120,
    height:15,
    isGround:false
  });
}

function drawBall(){
  ctx.fillStyle="#ff4fa0";
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius,0,Math.PI*2);
  ctx.fill();
}

function drawPlatforms(){
  ctx.fillStyle="#aa88aa";
  platforms.forEach(p=>{
    ctx.fillRect(p.x,p.y,p.width,p.height);
  });
}

function update(){
  // Cooldown für sanften Sprung
  if(ball.jumpCooldown > 0) ball.jumpCooldown--;

  // Gravitation
  ball.dy += gravity;
  ball.y += ball.dy;
  ball.onPlatform = false;

  // Plattform-Kollision
  platforms.forEach((p,i)=>{
    if(ball.x + ball.radius > p.x && ball.x - ball.radius < p.x + p.width &&
       ball.y + ball.radius > p.y && ball.y + ball.radius < p.y + p.height &&
       ball.dy > 0){

      ball.y = p.y - ball.radius;
      ball.onPlatform = true;

      // Nur springen, wenn Cooldown vorbei
      if(ball.jumpCooldown === 0){
        // Bodenplattform: springt nicht weg
        if(!p.isGround){
          ball.dy = -jumpStrength;
          ball.jumpCooldown = 8;
          hearts++;
        }
      }

      // Bodenplattform verschwindet nach erstem richtigen Sprung
      if(!p.isGround){
        // Entferne die Bodenplattform
        platforms = platforms.filter(pl => !pl.isGround);
      }
    }
  });

  // Scroll: Ball in Mitte
  if(ball.y < canvas.height/2){
    let diff = canvas.height/2 - ball.y;
    ball.y = canvas.height/2;
    platforms.forEach(p=>{
      p.y += diff;
      if(p.y > canvas.height){
        p.y = 0;
        if(!p.isGround){
          p.x = Math.random()*(canvas.width-120);
        }
      }
    });
  }

  // Herz-Ziel erreicht
  if(hearts >= targetHearts){
    setTimeout(()=>{ location.href="after1.html"; },500);
  }

  // Ball fällt zu weit → Reset
  if(ball.y > canvas.height){
    ball.x = canvas.width/2;
    ball.y = canvas.height-50;
    ball.dy = 0;
    hearts = 0;
    // Bodenplattform wieder hinzufügen
    if(!platforms.find(p=>p.isGround)){
      platforms.push(groundPlatform);
    }
  }

  document.getElementById("hud").innerText = `Herzen: ${hearts} / ${targetHearts}`;
}

// Maussteuerung
document.addEventListener("mousemove",(e)=>{
  ball.x = e.clientX;
});

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPlatforms();
  drawBall();
  update();
  requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>
