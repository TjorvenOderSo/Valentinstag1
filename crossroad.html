<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Cross the Road</title>
<style>
body{ margin:0; overflow:hidden; background:linear-gradient(#222,#444); font-family:sans-serif;}
canvas{ display:block; background:#6a9cd8;}
#overlay{
  position:absolute;
  top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.8);
  color:white; display:flex;
  flex-direction:column; justify-content:center; align-items:center;
  z-index:10;
}
#overlay button{
  margin-top:20px; padding:10px 20px; font-size:20px; cursor:pointer;
}
</style>
</head>
<body>

<div id="overlay">
  <h2>Cross the Road ðŸš¦</h2>
  <p>Der Ball muss die StraÃŸe Ã¼berqueren ohne von Autos getroffen zu werden.<br>
  Sammle 20 Herzen auf dem Weg. Du hast 3 Leben. Vermeide die Leitplanke oben!</p>
  <button id="startBtn">Spiel starten</button>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Steuerung
let mouseX = canvas.width/2;

// Spielvariablen
let ball = {x:canvas.width/2, y:canvas.height-50, radius:20};
let lives = 3;
let hearts = 0;
let targetHearts = 20;
let gameStarted = false;

// Autos
let cars = [];
for(let i=0;i<8;i++){
  cars.push({x:Math.random()*canvas.width, y:100 + i*70, width:80, height:40, speed:2+Math.random()*2});
}

// MÃ¼nzen/Herzen
let coins = [];
for(let i=0;i<15;i++){
  coins.push({x:Math.random()*(canvas.width-30)+15, y:Math.random()*(canvas.height-200)+50, radius:10, collected:false});
}

// Leitplanke oben
const barrier = {x:0, y:0, width:canvas.width, height:30};

function drawBall(){
  ctx.fillStyle="#ff4fa0";
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius,0,Math.PI*2);
  ctx.fill();
}

function drawCars(){
  ctx.fillStyle="red";
  cars.forEach(c=>{
    ctx.fillRect(c.x, c.y, c.width, c.height);
    c.x += c.speed;
    if(c.x > canvas.width) c.x = -c.width;
  });
}

function drawCoins(){
  coins.forEach(c=>{
    if(!c.collected){
      ctx.fillStyle="pink";
      ctx.beginPath();
      ctx.arc(c.x, c.y, c.radius,0,Math.PI*2);
      ctx.fill();
    }
  });
}

function drawBarrier(){
  ctx.fillStyle="#ffaa00"; // Leitplanke gelb-orange
  ctx.fillRect(barrier.x, barrier.y, barrier.width, barrier.height);
}

function checkCollisions(){
  // Autos
  cars.forEach(c=>{
    if(ball.x + ball.radius > c.x && ball.x - ball.radius < c.x + c.width &&
       ball.y + ball.radius > c.y && ball.y - ball.radius < c.y + c.height){
      hit();
    }
  });

  // Barrier oben
  if(ball.y - ball.radius < barrier.y + barrier.height){
    hit();
  }

  // Coins
  coins.forEach(c=>{
    if(!c.collected){
      let dx = ball.x - c.x;
      let dy = ball.y - c.y;
      if(Math.sqrt(dx*dx + dy*dy) < ball.radius + c.radius){
        c.collected = true;
        hearts++;
      }
    }
  });
}

function hit(){
  lives--;
  if(lives <=0){
    lives = 0;
    alert("Du wurdest zu oft getroffen. Versuch es nochmal!");
    resetGame();
  }else{
    // Ball zurÃ¼cksetzen
    ball.x = canvas.width/2;
    ball.y = canvas.height-50;
  }
}

function resetGame(){
  // Alle Coins zurÃ¼cksetzen
  coins.forEach(c=>c.collected=false);
  hearts = 0;
  lives = 3;
}

function update(){
  ball.x = mouseX;

  checkCollisions();

  // Ziel erreicht
  if(hearts >= targetHearts){
    setTimeout(()=>{ location.href="finalstory.html"; }, 500);
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawBarrier();
  drawBall();
  drawCars();
  drawCoins();

  // HUD
  ctx.fillStyle="white";
  ctx.font="22px Arial";
  ctx.fillText("Herzen: "+hearts+" / "+targetHearts,20,40);
  ctx.fillText("Leben: "+lives,20,70);

  if(gameStarted) update();
  requestAnimationFrame(draw);
}

draw();

// Maussteuerung
document.addEventListener("mousemove",(e)=>{
  mouseX = e.clientX;
});

// Start Button
document.getElementById("startBtn").addEventListener("click", ()=>{
  gameStarted = true;
  document.getElementById("overlay").style.display="none";
});
</script>

</body>
</html>
