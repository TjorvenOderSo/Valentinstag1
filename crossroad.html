<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Crossroad</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:#87ceeb;
}
canvas{ display:block; }

#hud{
  position:absolute;
  top:15px;
  left:15px;
  font-family:sans-serif;
  font-size:22px;
  color:white;
}

#gameOver{
  position:absolute;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.75);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  color:white;
  font-family:sans-serif;
  font-size:32px;
}

#gameOver button{
  margin-top:20px;
  padding:12px 25px;
  font-size:20px;
  border:none;
  border-radius:8px;
  background:#ff4fa0;
  color:white;
  cursor:pointer;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="hud">Herzen: 0 / 20 | Leben: 3</div>

<div id="gameOver">
  <div>Game Over ðŸ’€</div>
  <button onclick="restartGame()">Neu starten</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

/* ============================= */
/*           SETTINGS            */
/* ============================= */

const targetHearts = 20;
const carSpeed = 3.5;        // ruhig
const heartSpeed = 1.5;      // gut sammelbar
const spawnCarRate = 70;     // hÃ¶her = weniger Autos
const spawnHeartRate = 40;   // niedriger = mehr Herzen

/* ============================= */

let frame = 0;

let player = {
  x: canvas.width/2,
  y: canvas.height-100,
  radius: 22,
  speed: 6,
  lives: 3
};

let cars = [];
let hearts = [];
let collected = 0;

const barriers = [
  {x:0, width:70},
  {x:canvas.width-70, width:70}
];

const gameOverDiv = document.getElementById("gameOver");

/* ============================= */
/*           DRAWING             */
/* ============================= */

function drawPlayer(){
  ctx.fillStyle="#ff4fa0";
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius,0,Math.PI*2);
  ctx.fill();
}

function drawCars(){
  ctx.fillStyle="red";
  cars.forEach(car=>{
    ctx.fillRect(car.x, car.y, car.w, car.h);
  });
}

function drawHearts(){
  ctx.fillStyle="pink";
  hearts.forEach(h=>{
    ctx.beginPath();
    ctx.arc(h.x, h.y, h.r,0,Math.PI*2);
    ctx.fill();
  });
}

function drawBarriers(){
  ctx.fillStyle="#444";
  barriers.forEach(b=>{
    ctx.fillRect(b.x,0,b.width,canvas.height);
  });
}

/* ============================= */
/*            UPDATE             */
/* ============================= */

function update(){

  frame++;

  /* Spawn Cars */
  if(frame % spawnCarRate === 0){
    const x = 80 + Math.random()*(canvas.width-160-80);
    cars.push({x:x, y:-60, w:80, h:40});
  }

  /* Spawn Hearts */
  if(frame % spawnHeartRate === 0){
    const x = 80 + Math.random()*(canvas.width-160);
    hearts.push({x:x, y:-30, r:15});
  }

  /* Move Cars */
  cars.forEach(car=> car.y += carSpeed);
  cars = cars.filter(car=> car.y < canvas.height+50);

  /* Move Hearts */
  hearts.forEach(h=> h.y += heartSpeed);
  hearts = hearts.filter(h=> h.y < canvas.height+40);

  /* Heart Collision */
  hearts.forEach((h,i)=>{
    const dx = h.x - player.x;
    const dy = h.y - player.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < h.r + player.radius){
      collected++;
      hearts.splice(i,1);
    }
  });

  /* Car Collision */
  cars.forEach((car,i)=>{
    if(player.x + player.radius > car.x &&
       player.x - player.radius < car.x + car.w &&
       player.y + player.radius > car.y &&
       player.y - player.radius < car.y + car.h){
        player.lives--;
        cars.splice(i,1);
    }
  });

  /* Barrier Collision */
  barriers.forEach(b=>{
    if(player.x - player.radius < b.x + b.width &&
       player.x + player.radius > b.x){
        player.lives--;
        if(b.x === 0)
          player.x = b.x + b.width + player.radius + 1;
        else
          player.x = b.x - player.radius - 1;
    }
  });

  /* Top/Bottom Limit */
  if(player.y < 0) player.y = 0;
  if(player.y > canvas.height-player.radius)
    player.y = canvas.height-player.radius;

  /* Win Condition */
  if(collected >= targetHearts){
    setTimeout(()=>{ location.href="finalstory.html"; },500);
  }

  /* Lose Condition */
  if(player.lives <= 0){
    gameOverDiv.style.display="flex";
  }

  document.getElementById("hud").innerText =
    `Herzen: ${collected} / ${targetHearts} | Leben: ${player.lives}`;
}

/* ============================= */
/*          MOVEMENT             */
/* ============================= */

const keys = {};

document.addEventListener("keydown",(e)=> keys[e.key]=true);
document.addEventListener("keyup",(e)=> keys[e.key]=false);

function handleMovement(){
  if(keys["ArrowLeft"] || keys["a"]) player.x -= player.speed;
  if(keys["ArrowRight"] || keys["d"]) player.x += player.speed;
  if(keys["ArrowUp"] || keys["w"]) player.y -= player.speed;
  if(keys["ArrowDown"] || keys["s"]) player.y += player.speed;
}

/* ============================= */

function restartGame(){
  player.x = canvas.width/2;
  player.y = canvas.height-100;
  player.lives = 3;
  collected = 0;
  cars = [];
  hearts = [];
  gameOverDiv.style.display="none";
}

/* ============================= */

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  handleMovement();
  drawBarriers();
  drawHearts();
  drawCars();
  drawPlayer();
  update();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
