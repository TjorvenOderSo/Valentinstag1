<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Cross The Road</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:linear-gradient(#ffb6d5,#ffcce6);
}
canvas{
  display:block;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = {
  x: canvas.width/2,
  y: canvas.height - 60,
  size: 20
};

let lives = 3;
let goalLine = 50;
let gameOver = false;

let lanes = [];

// Spuren erzeugen
for(let i=0;i<5;i++){
  lanes.push({
    y: canvas.height - 150 - i*80,
    cars: []
  });

  for(let j=0;j<3;j++){
    lanes[i].cars.push({
      x: Math.random()*canvas.width,
      speed: 2 + Math.random()*2,
      width: 80,
      height: 40
    });
  }
}

function drawPlayer(){
  ctx.fillStyle="#ff4fa0";
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
  ctx.fill();
}

function drawCars(){
  ctx.fillStyle="#333";
  lanes.forEach(lane=>{
    lane.cars.forEach(car=>{
      ctx.fillRect(car.x, lane.y, car.width, car.height);
    });
  });
}

function updateCars(){
  lanes.forEach(lane=>{
    lane.cars.forEach(car=>{
      car.x += car.speed;
      if(car.x > canvas.width){
        car.x = -car.width;
      }

      // Kollision
      if(player.x > car.x &&
         player.x < car.x + car.width &&
         player.y + player.size > lane.y &&
         player.y - player.size < lane.y + car.height){
            lives--;
            player.x = canvas.width/2;
            player.y = canvas.height - 60;
      }
    });
  });
}

function checkWin(){
  if(player.y < goalLine){
    gameOver = true;
    setTimeout(()=>{
      location.href="finalStory.html";
    },1000);
  }
}

function drawUI(){
  ctx.fillStyle="black";
  ctx.font="20px Arial";
  ctx.fillText("Leben: " + lives,20,30);
}

function update(){
  if(gameOver) return;

  updateCars();
  checkWin();

  if(lives <= 0){
    alert("Du wurdest zu oft getroffen ðŸ’” Versuch es nochmal!");
    location.reload();
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawCars();
  drawPlayer();
  drawUI();

  update();
  requestAnimationFrame(draw);
}

draw();

// Steuerung
document.addEventListener("keydown",(e)=>{
  if(e.key === "ArrowUp") player.y -= 40;
  if(e.key === "ArrowDown") player.y += 40;
  if(e.key === "ArrowLeft") player.x -= 40;
  if(e.key === "ArrowRight") player.x += 40;
});
</script>

</body>
</html>
